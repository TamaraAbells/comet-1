import {
  K,
  N,
  createRequest,
  fromValue$1,
  makeSubject$1,
  map$1,
  onEnd$1,
  onStart$1,
  publish$1,
  v,
  visit,
  y
} from "./chunk.QDKH3HXJ.js";
import {
  take$1,
  toPromise$1
} from "./chunk.U6CQNBPC.js";
import {
  A,
  B,
  D,
  Kind,
  filter$1,
  m,
  make$1,
  makeFetchBody,
  makeFetchOptions,
  makeFetchSource,
  makeFetchURL,
  merge$1,
  share$1,
  takeUntil$1,
  u,
  w,
  z
} from "./chunk.2QC3HF4U.js";
import {
  H
} from "./chunk.ZKDFWQVH.js";
import {
  require_printer
} from "./chunk.WZSZG6XK.js";
import "./chunk.K5PCYWJY.js";
import "./chunk.BROQQF2P.js";
import "./chunk.FNFVRXQK.js";
import "./chunk.5OSL2VXB.js";
import {
  __name
} from "./chunk.C4F35LU4.js";

// ../.yarn/$$virtual/@urql-core-virtual-9f6d4998ab/0/cache/@urql-core-npm-2.0.0-7689f44c21-43890e0dc9.zip/node_modules/@urql/core/dist/urql-core.mjs
var import_printer = require_printer();
function n(a, b) {
  if (Array.isArray(a)) {
    for (var c = 0; c < a.length; c++) {
      n(a[c], b);
    }
  } else if (typeof a == "object" && a !== null) {
    for (c in a) {
      c === "__typename" && typeof a[c] == "string" ? b[a[c]] = 0 : n(a[c], b);
    }
  }
  return b;
}
__name(n, "n");
function p(a) {
  return a.kind === Kind.FIELD && a.name.value === "__typename" && !a.alias;
}
__name(p, "p");
function r(a) {
  if (a.selectionSet && !a.selectionSet.selections.some(p)) {
    return B({}, a, {
      selectionSet: B({}, a.selectionSet, {
        selections: a.selectionSet.selections.concat([{
          kind: Kind.FIELD,
          name: {
            kind: Kind.NAME,
            value: "__typename"
          }
        }])
      })
    });
  }
}
__name(r, "r");
function u2(a) {
  a = y(a);
  var b = t.get(a.__key);
  b || ((b = visit(a, {
    Field: r,
    InlineFragment: r
  })).__key = a.__key, t.set(a.__key, b));
  return b;
}
__name(u2, "u");
function v2(a) {
  return a && typeof a == "object" ? Object.keys(a).reduce(function(b, c) {
    var d = a[c];
    c === "__typename" ? Object.defineProperty(b, "__typename", {
      enumerable: false,
      value: d
    }) : Array.isArray(d) ? b[c] = d.map(v2) : b[c] = d && typeof d == "object" && "__typename" in d ? v2(d) : d;
    return b;
  }, {}) : a;
}
__name(v2, "v");
function w2(a) {
  a.toPromise = function() {
    return toPromise$1(take$1(1)(a));
  };
  return a;
}
__name(w2, "w");
function x(a, b, c) {
  c || (c = b.context);
  return {
    key: b.key,
    query: b.query,
    variables: b.variables,
    kind: a,
    context: c
  };
}
__name(x, "x");
function y2(a, b) {
  return x(a.kind, a, B({}, a.context, {
    meta: B({}, a.context.meta, b)
  }));
}
__name(y2, "y");
function z2() {
}
__name(z2, "z");
function A2(a, b, c) {
  var d, e, f;
  for (d = 0; d < c.length; d++) {
    if (c[d].kind === Kind.FRAGMENT_DEFINITION) {
      e = c[d].name.value, f = v(c[d]);
      a.has(e) ? a.get(e) !== f && console.warn("[WARNING: Duplicate Fragment] A fragment with name `" + e + "` already exists in this document.\nWhile fragment names may not be unique across your source, each name must be unique per document.") : (a.set(e, f), b.push(c[d]));
    } else {
      b.push(c[d]);
    }
  }
}
__name(A2, "A");
function B2(a) {
  return (a = a.kind) !== "subscription" && a !== "query";
}
__name(B2, "B");
function C(a) {
  return a.path || a.extensions ? {
    message: a.message,
    path: a.path,
    extensions: a.extensions
  } : a.message;
}
__name(C, "C");
function D2(a) {
  return (a = a.kind) !== "mutation" && a !== "query";
}
__name(D2, "D");
function E(a) {
  var b = x(a.kind, a);
  b.query = u2(a.query);
  return b;
}
__name(E, "E");
function F(a) {
  return a.kind !== "query" || a.context.requestPolicy !== "cache-only";
}
__name(F, "F");
function G(a) {
  return y2(a, {
    cacheOutcome: "miss"
  });
}
__name(G, "G");
function H2(a) {
  return D2(a);
}
__name(H2, "H");
function I(a) {
  function b(a2) {
    var b2 = a2.context.requestPolicy;
    return a2.kind === "query" && b2 !== "network-only" && (b2 === "cache-only" || k.has(a2.key));
  }
  __name(b, "b");
  function c(a2) {
    var c2 = k.get(a2.key);
    q(B({}, {
      operation: a2
    }, c2 ? {
      type: "cacheHit",
      message: "The result was successfully retried from the cache"
    } : {
      type: "cacheMiss",
      message: "The result could not be retrieved from the cache"
    }));
    c2 = B({}, c2, {
      operation: y2(a2, {
        cacheOutcome: c2 ? "hit" : "miss"
      })
    });
    a2.context.requestPolicy === "cache-and-network" && (c2.stale = true, J(m2, a2));
    return c2;
  }
  __name(c, "c");
  function d(a2) {
    return !D2(a2) && b(a2);
  }
  __name(d, "d");
  function e(a2) {
    function c2(a3) {
      g2.add(a3);
    }
    __name(c2, "c");
    var e2, g2, l, d2 = a2.operation;
    if (d2) {
      e2 = Object.keys(n(a2.data, {})).concat(d2.context.additionalTypenames || []);
      if (a2.operation.kind === "mutation") {
        g2 = new Set();
        q({
          type: "cacheInvalidation",
          message: "The following typenames have been invalidated: " + e2,
          operation: d2,
          data: {
            typenames: e2,
            response: a2
          },
          source: "cacheExchange"
        });
        for (a2 = 0; a2 < e2.length; a2++) {
          (l = h[l = e2[a2]] || (h[l] = new Set())).forEach(c2);
          l.clear();
        }
        g2.forEach(/* @__PURE__ */ __name(function b2(a3) {
          k.has(a3) && (d2 = k.get(a3).operation, k.delete(a3), J(m2, d2));
        }, "b"));
      } else if (d2.kind === "query" && a2.data) {
        for (k.set(d2.key, a2), a2 = 0; a2 < e2.length; a2++) {
          (h[l = e2[a2]] || (h[l] = new Set())).add(d2.key);
        }
      }
    }
  }
  __name(e, "e");
  function f(a2) {
    return !D2(a2) && !b(a2);
  }
  __name(f, "f");
  var g = a.forward, m2 = a.client, q = a.dispatchDebug, k = new Map(), h = Object.create(null);
  return function(a2) {
    var b2 = share$1(a2);
    a2 = map$1(c)(filter$1(d)(b2));
    b2 = H(e)(g(filter$1(F)(map$1(G)(merge$1([map$1(E)(filter$1(f)(b2)), filter$1(H2)(b2)])))));
    return merge$1([a2, b2]);
  };
}
__name(I, "I");
function J(a, b) {
  return a.reexecuteOperation(x(b.kind, b, B({}, b.context, {
    requestPolicy: "network-only"
  })));
}
__name(J, "J");
function K2(a) {
  return console.log("[Exchange debug]: Completed operation: ", a);
}
__name(K2, "K");
function L(a) {
  return console.log("[Exchange debug]: Incoming operation: ", a);
}
__name(L, "L");
function M(a) {
  function b(a2) {
    f.delete(a2.operation.key);
  }
  __name(b, "b");
  function c(a2) {
    var c2 = a2.key, b2 = a2.kind;
    if (b2 === "teardown") {
      return f.delete(c2), true;
    }
    if (b2 !== "query" && b2 !== "subscription") {
      return true;
    }
    b2 = f.has(c2);
    f.add(c2);
    b2 && true && e({
      type: "dedup",
      message: "An operation has been deduped.",
      operation: a2,
      source: "dedupExchange"
    });
    return !b2;
  }
  __name(c, "c");
  var d = a.forward, e = a.dispatchDebug, f = new Set();
  return function(a2) {
    a2 = filter$1(c)(a2);
    return H(b)(d(a2));
  };
}
__name(M, "M");
function N2(a) {
  return a.kind === "query" || a.kind === "mutation";
}
__name(N2, "N");
function O(a) {
  return a.kind !== "query" && a.kind !== "mutation";
}
__name(O, "O");
function P(a) {
  var b = a.forward, c = a.dispatchDebug;
  return function(a2) {
    var f, d = share$1(a2);
    a2 = D(function(a3) {
      var b2 = a3.key, e = filter$1(function(a4) {
        return a4.kind === "teardown" && a4.key === b2;
      })(d), g = makeFetchBody(a3), h = makeFetchURL(a3, g), l = makeFetchOptions(a3, g);
      c({
        type: "fetchRequest",
        message: "A fetch request is being executed.",
        operation: a3,
        data: {
          url: h,
          fetchOptions: l
        },
        source: "fetchExchange"
      });
      return H(function(b3) {
        var d2 = b3.data ? void 0 : b3.error;
        c({
          type: d2 ? "fetchError" : "fetchSuccess",
          message: "A " + (d2 ? "failed" : "successful") + " fetch response has been returned.",
          operation: a3,
          data: {
            url: h,
            fetchOptions: l,
            value: d2 || b3
          },
          source: "fetchExchange"
        });
      })(takeUntil$1(e)(makeFetchSource(a3, h, l)));
    })(filter$1(N2)(d));
    f = b(filter$1(O)(d));
    return merge$1([a2, f]);
  };
}
__name(P, "P");
function Q() {
  return false;
}
__name(Q, "Q");
function R(a) {
  function b(a2) {
    if (a2.kind !== "teardown" && true) {
      var b2 = 'No exchange has handled operations of kind "' + a2.kind + `". Check whether you've added an exchange responsible for these operations.`;
      c({
        type: "fallbackCatch",
        message: b2,
        operation: a2,
        source: "fallbackExchange"
      });
      console.warn(b2);
    }
  }
  __name(b, "b");
  var c = a.dispatchDebug;
  return function(a2) {
    return filter$1(Q)(H(b)(a2));
  };
}
__name(R, "R");
function T(a) {
  return function(b) {
    var c = b.client, d = b.dispatchDebug;
    return a.reduceRight(function(a2, b2) {
      return b2({
        client: c,
        forward: a2,
        dispatchDebug: function(a3) {
          d(B({}, {
            timestamp: Date.now(),
            source: b2.name
          }, a3));
        }
      });
    }, b.forward);
  };
}
__name(T, "T");
function V(a) {
  var d, e, f, g, m2, c = this;
  this.activeOperations = Object.create(null);
  this.queue = [];
  this.createOperationContext = function(a2) {
    a2 || (a2 = {});
    return B({}, {
      url: c.url,
      fetchOptions: c.fetchOptions,
      fetch: c.fetch,
      preferGetMethod: c.preferGetMethod
    }, a2, {
      suspense: a2.suspense || a2.suspense !== false && c.suspense,
      requestPolicy: a2.requestPolicy || c.requestPolicy
    });
  };
  this.createRequestOperation = function(a2, b, d2) {
    return x(a2, b, c.createOperationContext(d2));
  };
  this.executeQuery = function(a2, b) {
    a2 = c.createRequestOperation("query", a2, b);
    return c.executeRequestOperation(a2);
  };
  this.executeSubscription = function(a2, b) {
    a2 = c.createRequestOperation("subscription", a2, b);
    return c.executeRequestOperation(a2);
  };
  this.executeMutation = function(a2, b) {
    a2 = c.createRequestOperation("mutation", a2, b);
    return c.executeRequestOperation(a2);
  };
  if (!a.url) {
    throw Error("You are creating an urql-client without a url.");
  }
  d = z2;
  if (true) {
    e = (d = makeSubject$1()).next, f = d.source;
    this.subscribeToDebugTarget = /* @__PURE__ */ __name(function b(a2) {
      return N(a2)(f);
    }, "b");
    d = e;
  }
  this.url = a.url;
  this.fetchOptions = a.fetchOptions;
  this.fetch = a.fetch;
  this.suspense = !!a.suspense;
  this.requestPolicy = a.requestPolicy || "cache-first";
  this.preferGetMethod = !!a.preferGetMethod;
  this.maskTypename = !!a.maskTypename;
  e = makeSubject$1();
  g = e.next;
  this.operations$ = e.source;
  m2 = false;
  this.dispatchOperation = function(a2) {
    m2 = true;
    for (a2 && g(a2); a2 = c.queue.shift(); ) {
      g(a2);
    }
    m2 = false;
  };
  this.reexecuteOperation = function(a2) {
    if (a2.kind === "mutation" || 0 < (c.activeOperations[a2.key] || 0)) {
      c.queue.push(a2), m2 || Promise.resolve().then(c.dispatchOperation);
    }
  };
  a = T(a.exchanges !== void 0 ? a.exchanges : U);
  this.results$ = share$1(a({
    client: this,
    dispatchDebug: d,
    forward: R({
      dispatchDebug: d
    })
  })(this.operations$));
  publish$1(this.results$);
}
__name(V, "V");
function W(a) {
  a.data = v2(a.data);
  return a;
}
__name(W, "W");
function createClient(a) {
  return new V(a);
}
__name(createClient, "createClient");
function debugExchange(a) {
  var d = a.forward;
  return false ? /* @__PURE__ */ __name(function b(a2) {
    return d(a2);
  }, "b") : /* @__PURE__ */ __name(function c(a2) {
    return H(K2)(d(H(L)(a2)));
  }, "c");
}
__name(debugExchange, "debugExchange");
function errorExchange(a) {
  function b(a2) {
    var b2 = a2.error;
    a2 = a2.operation;
    b2 && c(b2, a2);
  }
  __name(b, "b");
  var c = a.onError;
  return function(a2) {
    var c2 = a2.forward;
    return function(a3) {
      return H(b)(c2(a3));
    };
  };
}
__name(errorExchange, "errorExchange");
function gql() {
  var a, b, c, d, e, f, g;
  for (a = arguments, b = new Map(), c = [], d = [], e = Array.isArray(arguments[0]) ? arguments[0][0] : arguments[0] || "", f = 1; f < arguments.length; f++) {
    (g = a[f]) && g.definitions ? d.push.apply(d, g.definitions) : e += g;
    e += a[0][f];
  }
  A2(b, c, y(e).definitions);
  A2(b, c, d);
  return y({
    kind: Kind.DOCUMENT,
    definitions: c
  });
}
__name(gql, "gql");
function ssrExchange(a) {
  function b(b2) {
    var c2 = b2.client, l = b2.forward;
    return function(b3) {
      var e2 = a && typeof a.isClient == "boolean" ? !!a.isClient : !c2.suspense, h2 = share$1(b3);
      b3 = l(filter$1(f)(h2));
      h2 = map$1(g)(filter$1(m2)(h2));
      e2 ? h2 = H(d)(h2) : b3 = H(q)(b3);
      return merge$1([b3, h2]);
    };
  }
  __name(b, "b");
  function c(a2) {
    return !B2(a2) && k[a2.key] !== void 0;
  }
  __name(c, "c");
  function d(a2) {
    h.push(a2.operation.key);
    h.length === 1 && Promise.resolve().then(e);
  }
  __name(d, "d");
  function e() {
    for (var a2; a2 = h.shift(); ) {
      delete k[a2];
    }
  }
  __name(e, "e");
  function f(a2) {
    return !c(a2);
  }
  __name(f, "f");
  function g(a2) {
    var b2 = k[a2.key], c2 = b2.error;
    return {
      operation: a2,
      data: (b2 = b2.data) ? JSON.parse(b2) : void 0,
      extensions: void 0,
      error: c2 ? new m({
        networkError: c2.networkError ? Error(c2.networkError) : void 0,
        graphQLErrors: c2.graphQLErrors && c2.graphQLErrors.length ? c2.graphQLErrors : void 0
      }) : void 0
    };
  }
  __name(g, "g");
  function m2(a2) {
    return c(a2);
  }
  __name(m2, "m");
  function q(a2) {
    var c2, d2, b2 = a2.operation;
    if (!B2(b2)) {
      c2 = a2.data;
      a2 = a2.error;
      d2 = {};
      c2 !== void 0 && (d2.data = JSON.stringify(c2));
      a2 && (d2.error = {
        graphQLErrors: a2.graphQLErrors.map(C)
      }, a2.networkError && (d2.error.networkError = "" + a2.networkError));
      k[b2.key] = d2;
    }
  }
  __name(q, "q");
  var k = {}, h = [];
  b.restoreData = function(a2) {
    return B(k, a2);
  };
  b.extractData = function() {
    return B({}, k);
  };
  a && a.initialState && b.restoreData(a.initialState);
  return b;
}
__name(ssrExchange, "ssrExchange");
function subscriptionExchange(a) {
  function b(a2) {
    return (a2 = a2.kind) === "subscription" || !!d && (a2 === "query" || a2 === "mutation");
  }
  __name(b, "b");
  var c = a.forwardSubscription, d = a.enableAllOperations;
  return function(a2) {
    function d2(a3) {
      var b2 = c({
        key: a3.key.toString(36),
        query: (0, import_printer.print)(a3.query),
        variables: a3.variables,
        context: B({}, a3.context)
      });
      return make$1(function(c2) {
        function d3(b3) {
          return f(z(a3, b3));
        }
        __name(d3, "d");
        function e2(b3) {
          return f(A(a3, b3));
        }
        __name(e2, "e");
        function h() {
          g || (g = true, a3.kind === "subscription" && m2.reexecuteOperation(x("teardown", a3, a3.context)), l());
        }
        __name(h, "h");
        var k2, f = c2.next, l = c2.complete, g = false;
        Promise.resolve().then(function() {
          g || (k2 = b2.subscribe({
            next: d3,
            error: e2,
            complete: h
          }));
        });
        return function() {
          g = true;
          k2 && k2.unsubscribe();
        };
      });
    }
    __name(d2, "d");
    function e(a3) {
      return !k(a3);
    }
    __name(e, "e");
    var m2 = a2.client, q = a2.forward, k = b;
    return function(a3) {
      var c2, b2 = share$1(a3);
      a3 = D(function(a4) {
        var c3 = a4.key, e2 = filter$1(function(a5) {
          return a5.kind === "teardown" && a5.key === c3;
        })(b2);
        return takeUntil$1(e2)(d2(a4));
      })(filter$1(k)(b2));
      c2 = q(filter$1(e)(b2));
      return merge$1([a3, c2]);
    };
  };
}
__name(subscriptionExchange, "subscriptionExchange");
var t;
var S;
var U;
t = new Map();
S = R({
  dispatchDebug: z2
});
U = [M, I, P];
V.prototype.onOperationStart = function(a) {
  var b = a.key;
  this.activeOperations[b] = (this.activeOperations[b] || 0) + 1;
  this.dispatchOperation(a);
};
V.prototype.onOperationEnd = function(a) {
  var b = a.key, c = this.activeOperations[b] || 0;
  if (0 >= (this.activeOperations[b] = 0 >= c ? 0 : c - 1)) {
    for (b = this.queue.length - 1; 0 <= b; b--) {
      this.queue[b].key === a.key && this.queue.splice(b, 1);
    }
    this.dispatchOperation(x("teardown", a, a.context));
  }
};
V.prototype.executeRequestOperation = function(a) {
  var e, f, c = this, d = filter$1(function(b) {
    return b.operation.key === a.key;
  })(this.results$);
  this.maskTypename && (d = map$1(W)(d));
  if (a.kind === "mutation") {
    return take$1(1)(onStart$1(/* @__PURE__ */ __name(function b() {
      return c.dispatchOperation(a);
    }, "b"))(d));
  }
  e = filter$1(function(b) {
    return b.kind === "teardown" && b.key === a.key;
  })(this.operations$), f = filter$1(function(b) {
    return b.kind === a.kind && b.key === a.key && b.context.requestPolicy !== "cache-only";
  })(this.operations$);
  return onEnd$1(function() {
    c.onOperationEnd(a);
  })(onStart$1(function() {
    c.onOperationStart(a);
  })(K(function(a2) {
    return a2.stale ? fromValue$1(a2) : merge$1([fromValue$1(a2), map$1(function() {
      return B({}, a2, {
        stale: true
      });
    })(take$1(1)(f))]);
  })(takeUntil$1(e)(d))));
};
V.prototype.query = function(a, b, c) {
  c && typeof c.suspense == "boolean" || (c = B({}, c, {
    suspense: false
  }));
  return w2(this.executeQuery(createRequest(a, b), c));
};
V.prototype.readQuery = function(a, b, c) {
  var d = null;
  N(function(a2) {
    d = a2;
  })(this.executeQuery(createRequest(a, b), c)).unsubscribe();
  return d;
};
V.prototype.subscription = function(a, b, c) {
  return this.executeSubscription(createRequest(a, b), c);
};
V.prototype.mutation = function(a, b, c) {
  return w2(this.executeMutation(createRequest(a, b), c));
};
export {
  V as Client,
  m as CombinedError,
  I as cacheExchange,
  T as composeExchanges,
  createClient,
  createRequest,
  debugExchange,
  M as dedupExchange,
  U as defaultExchanges,
  errorExchange,
  S as fallbackExchangeIO,
  P as fetchExchange,
  u2 as formatDocument,
  w as getOperationName,
  gql,
  A as makeErrorResult,
  x as makeOperation,
  z as makeResult,
  v2 as maskTypename,
  ssrExchange,
  u as stringifyVariables,
  subscriptionExchange
};
//# sourceMappingURL=@urql_core.js.map
