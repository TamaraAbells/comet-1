spec:
  name: cometx

  services:
  - name: api
    github:
      repo: cometx-io/cometx
      branch: main
      deploy_on_push: true
    source_dir: api
    dockerfile_path: api/Dockerfile
    http_port: 4000
    routes:
    - path: /api
    envs:
    - key: DATABASE_URL
      scope: RUN_TIME
      value: ${db.DATABASE_URL}

  - name: frontend
    github:
      repo: cometx-io/cometx
      branch: main
      deploy_on_push: true
    source_dir: frontend
    dockerfile_path: frontend/Dockerfile
    http_port: 3000
    routes:
    - path: /
    envs:
    - key: API_PRIVATE_URL
      scope: RUN_TIME
      value: ${api.PRIVATE_URL}
    - key: NEXT_PUBLIC_API_PUBLIC_URL
      scope: RUN_TIME
      value: ${api.PUBLIC_URL}

  databases:
  - name: db
    engine: PG
    production: false
